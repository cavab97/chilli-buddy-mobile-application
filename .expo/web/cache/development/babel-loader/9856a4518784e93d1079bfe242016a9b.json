{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\ZuMei\\\\gogogainUser\\\\src\\\\screens\\\\main\\\\RouteGroups\\\\Route\\\\index.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport Share from \"react-native-web/dist/exports/Share\";\nimport { connect } from \"react-redux\";\nimport { Actions } from \"react-native-router-flux\";\nimport { SingleRoutes } from \"../../../../components/templates\";\nimport { listenToRecord as listenToRoute, removeListenerToRecord as removeListenerFromRoute } from \"../../../../redux/route/action\";\nimport { listenToRecord as listenToRouteTicket, removeListenerToRecord as removeListenerFromRouteTicket, submitToBackend as submitRouteTicket } from \"../../../../redux/routeTicket/action\";\nimport { readFromDatabase as readMissions, modalControl as missionModalControl } from \"../../../../redux/mission/action\";\nimport { readFromDatabase as readRewards } from \"../../../../redux/reward/action\";\nimport { submitToBackend as submitTransaction } from \"../../../../redux/transaction/action\";\nimport styles from \"./styles\";\nimport { Linking } from \"expo\";\nimport clone from \"clone\";\n\nvar index = function (_Component) {\n  _inherits(index, _Component);\n\n  var _super = _createSuper(index);\n\n  function index(props) {\n    var _this;\n\n    _classCallCheck(this, index);\n\n    _this = _super.call(this, props);\n\n    _this.handleModal = function (mission) {\n      _this.props.missionModalControl(mission);\n    };\n\n    _this.onPay = function (mission) {\n      var routeId = _this.props.navigation.state.params.routeId;\n\n      var routeTicketId = _this.lookingForTicket({\n        routeId: routeId\n      });\n\n      var shopId = mission.shop.id;\n      var missionId = mission.id;\n      var payment = {\n        amount: 50,\n        paymentId: null,\n        paymentType: \"cash\",\n        receiptId: null,\n        receiptPhotoUrl: \"https://image.freepik.com/free-vector/realistic-receipt-template_23-2147938550.jpg\",\n        receiptUrl: null\n      };\n      var data = {\n        routeId: routeId,\n        shopId: shopId,\n        routeTicketId: routeTicketId,\n        missionId: missionId,\n        payment: payment\n      };\n\n      _this.props.submitTransaction(data, \"create\");\n    };\n\n    _this.onPayAmount = function (mission) {\n      _this.props.missionModalControl(mission);\n\n      Actions.Amount({\n        mission: mission,\n        routeId: _this.props.navigation.state.params.routeId\n      });\n    };\n\n    _this.onRulesPress = function (rules, terms) {\n      Actions.Rules({\n        rules: rules,\n        terms: terms\n      });\n    };\n\n    _this.state = {\n      isVisible: false,\n      shared: false,\n      invited: false,\n      showModalVisible: true,\n      routeTicketId: null,\n      error: null,\n      showErrorModalVisible: false\n    };\n    return _this;\n  }\n\n  _createClass(index, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var routeId = this.props.navigation.state.params.routeId;\n      var routeTicketId = this.lookingForTicket({\n        routeId: routeId\n      });\n      this.props.listenToRoute({\n        routeId: routeId\n      });\n      this.props.readMissions({\n        routeId: routeId\n      });\n      this.props.readRewards({\n        routeId: routeId\n      });\n\n      if (routeTicketId) {\n        this.props.listenToRouteTicket({\n          routeTicketId: routeTicketId\n        });\n        this.setState({\n          routeTicketId: routeTicketId\n        });\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.props.removeListenerFromRoute();\n      this.props.removeListenerFromRouteTicket();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      var _this2 = this;\n\n      var routeId = this.props.navigation.state.params.routeId;\n      var route = this.props.routeState.route;\n\n      if ((this.state.shared !== prevState.shared || this.state.invited !== prevState.invited) && route.type === \"Luxury\" && this.state.invited && this.state.shared && !this.state.routeTicketId) {\n        this.props.submitRouteTicket({\n          routeId: routeId\n        }, \"create\");\n      }\n\n      if (this.state.shared !== prevState.shared && route.type === \"Casual\" && this.state.shared && !this.state.routeTicketId) {\n        this.props.submitRouteTicket({\n          routeId: routeId\n        }, \"create\");\n      }\n\n      if (this.props.submitRouteTicketError.message !== prevProps.submitRouteTicketError.message && this.props.submitRouteTicketError.message) {\n        this.setState({\n          error: this.props.submitRouteTicketError.message,\n          showErrorModalVisible: true\n        });\n        setTimeout(function () {\n          _this2.setState({\n            showErrorModalVisible: false\n          });\n        }, 3000);\n      }\n\n      if (this.props.submitRouteTicketResult.message !== prevProps.submitRouteTicketResult.message && this.props.submitRouteTicketResult.message) {\n        this.props.listenToRouteTicket({\n          routeTicketId: this.props.submitRouteTicketResult.ids[0]\n        });\n        this.setState({\n          routeTicketId: this.props.submitRouteTicketResult.ids[0]\n        });\n      }\n    }\n  }, {\n    key: \"lookingForTicket\",\n    value: function lookingForTicket(_ref) {\n      var _ref$routeId = _ref.routeId,\n          routeId = _ref$routeId === void 0 ? null : _ref$routeId;\n      var _this$props$routeTick = this.props.routeTicketState.routeTickets,\n          routeTickets = _this$props$routeTick === void 0 ? [] : _this$props$routeTick;\n      var routeTicketId = null;\n      routeTickets.forEach(function (routeTicket) {\n        if (routeTicket.routeIds[0] === routeId) {\n          routeTicketId = routeTicket.id;\n        }\n      });\n      return routeTicketId;\n    }\n  }, {\n    key: \"toolTipPress\",\n    value: function toolTipPress() {\n      this.setState(function (state) {\n        return {\n          toolTipVisible: !state.toolTipVisible\n        };\n      });\n    }\n  }, {\n    key: \"onUnlockPress\",\n    value: function onUnlockPress() {\n      this.setState(function (state) {\n        return {\n          isVisible: !state.isVisible\n        };\n      });\n    }\n  }, {\n    key: \"onShare\",\n    value: function onShare() {\n      var _this3 = this;\n\n      var settingInfo = this.props.settingInfo;\n      var fbPost = settingInfo.share.fbPost;\n      Linking.openURL(\"https://www.facebook.com/sharer/sharer.php?u=\" + fbPost);\n      setTimeout(function () {\n        _this3.setState({\n          shared: true\n        });\n\n        console.log(\"Share successful\");\n      }, 3000);\n    }\n  }, {\n    key: \"onInvite\",\n    value: function onInvite() {\n      var _this4 = this;\n\n      var settingInfo = this.props.settingInfo;\n      var _settingInfo$share = settingInfo.share,\n          fbPost = _settingInfo$share.fbPost,\n          title = _settingInfo$share.title,\n          message = _settingInfo$share.message;\n      var shareOptions = {\n        title: title,\n        message: message + \" \" + fbPost,\n        url: fbPost,\n        subject: title\n      };\n      Share.share(shareOptions).then(function (_ref2) {\n        var action = _ref2.action,\n            activityType = _ref2.activityType;\n\n        if (action === Share.dismissedAction) {\n          console.log(\"Share dismissed\");\n        } else {\n          setTimeout(function () {\n            _this4.setState({\n              invited: true\n            });\n\n            console.log(\"Share successfuld\");\n          }, 3000);\n        }\n      }).catch(function (error) {\n        return _this4.setState({\n          result: \"error: \" + error.message\n        });\n      });\n    }\n  }, {\n    key: \"mapPress\",\n    value: function mapPress() {\n      console.log('I am clicked');\n    }\n  }, {\n    key: \"onRankingPress\",\n    value: function onRankingPress() {\n      var routeId = this.props.navigation.state.params.routeId;\n      Actions.RouteRanking({\n        routeId: routeId\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var routeTicket = this.props.routeTicketState.routeTicket;\n      var route = this.props.routeState.route;\n      var _this$props$missionSt = this.props.missionState,\n          mission = _this$props$missionSt.mission,\n          modalActive = _this$props$missionSt.modalActive;\n      var rewards = this.props.rewardState.rewards;\n      var _this$props = this.props,\n          submitRouteTicketLoading = _this$props.submitRouteTicketLoading,\n          readLoadingRouteTicket = _this$props.readLoadingRouteTicket,\n          readLoadingRoute = _this$props.readLoadingRoute,\n          readLoadingMission = _this$props.readLoadingMission,\n          readLoadingReward = _this$props.readLoadingReward;\n\n      var _clone = clone(this.props.missionState),\n          missions = _clone.missions;\n\n      var banner = route.images[0] ? route.images[0] : require(\"../../../../assets/banner.jpg\");\n      var map = route.station === 9 ? require(\"../../../../assets/gogogain/RouteMap_FA.png\") : require(\"../../../../assets/gogogain/RouteMap_FA_Blue.png\");\n      var uncompleteMissions = [];\n      var completedMissions = [];\n      var processedMissions = [];\n      missions.sort(function (a, b) {\n        return a.minSpend - b.minSpend;\n      });\n      missions.forEach(function (mission) {\n        var completedMission = routeTicket.completedMissions.filter(function (completedMission) {\n          return completedMission.id === mission.id;\n        });\n\n        if (completedMission.length > 0) {\n          mission = _objectSpread({}, mission, {\n            completed: true\n          });\n          processedMissions.push(mission);\n        } else {\n          mission = _objectSpread({}, mission, {\n            completed: false\n          });\n          processedMissions.push(mission);\n        }\n      });\n      return React.createElement(SingleRoutes, {\n        currency: \"RM\",\n        routeData: route,\n        isJoined: this.state.routeTicketId ? true : false,\n        routeTicketData: routeTicket,\n        banner: banner,\n        map: map,\n        isVisible: this.state.isVisible,\n        onUnlockPress: this.onUnlockPress.bind(this),\n        isUnlockLoading: submitRouteTicketLoading,\n        facebookButtonTitle: \"Share our Facebook\",\n        inviteButtonTitle: \"Invite Friends\",\n        facebookSharePress: this.onShare.bind(this),\n        invitePress: this.onInvite.bind(this),\n        missionData: processedMissions,\n        mission: mission,\n        missionPress: this.handleModal.bind(this),\n        showModal: modalActive,\n        descriptionTitle: \"Description\",\n        payTitle: \"Pay\",\n        onPay: this.onPay,\n        onPayAmount: this.onPayAmount,\n        onRulesPress: this.onRulesPress.bind(this),\n        onRankingPress: this.onRankingPress.bind(this),\n        readLoadingRouteTicket: readLoadingRouteTicket,\n        readLoadingRoute: readLoadingRoute,\n        readLoadingMission: readLoadingMission,\n        readLoadingReward: readLoadingReward,\n        errorSubmit: this.state.error,\n        errorModal: this.state.showErrorModalVisible,\n        errorHeader: \"Error\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 7\n        }\n      });\n    }\n  }]);\n\n  return index;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  var routeTicketState = state.RouteTicket;\n  var submitRouteTicketLoading = state.RouteTicket.submitLoading;\n  var submitRouteTicketResult = state.RouteTicket.submitResult;\n  var submitRouteTicketError = state.RouteTicket.submitError;\n  var routeState = state.Route;\n  var missionState = state.Mission;\n  var rewardState = state.Reward;\n  var settingInfo = state.Settings.info;\n  var readLoadingRouteTicket = state.RouteTicket.readLoading;\n  var readLoadingRoute = state.Route.readLoading;\n  var readLoadingMission = state.Mission.readLoading;\n  var readLoadingReward = state.Reward.readLoading;\n  return {\n    routeState: routeState,\n    routeTicketState: routeTicketState,\n    missionState: missionState,\n    rewardState: rewardState,\n    settingInfo: settingInfo,\n    submitRouteTicketLoading: submitRouteTicketLoading,\n    submitRouteTicketResult: submitRouteTicketResult,\n    submitRouteTicketError: submitRouteTicketError,\n    readLoadingRouteTicket: readLoadingRouteTicket,\n    readLoadingRoute: readLoadingRoute,\n    readLoadingMission: readLoadingMission,\n    readLoadingReward: readLoadingReward\n  };\n};\n\nexport default connect(mapStateToProps, {\n  submitRouteTicket: submitRouteTicket,\n  listenToRoute: listenToRoute,\n  removeListenerFromRoute: removeListenerFromRoute,\n  listenToRouteTicket: listenToRouteTicket,\n  removeListenerFromRouteTicket: removeListenerFromRouteTicket,\n  readMissions: readMissions,\n  missionModalControl: missionModalControl,\n  readRewards: readRewards,\n  submitTransaction: submitTransaction\n})(index);","map":{"version":3,"sources":["C:/Users/User/Desktop/ZuMei/gogogainUser/src/screens/main/RouteGroups/Route/index.js"],"names":["React","Component","connect","Actions","SingleRoutes","listenToRecord","listenToRoute","removeListenerToRecord","removeListenerFromRoute","listenToRouteTicket","removeListenerFromRouteTicket","submitToBackend","submitRouteTicket","readFromDatabase","readMissions","modalControl","missionModalControl","readRewards","submitTransaction","styles","Linking","clone","index","props","handleModal","mission","onPay","routeId","navigation","state","params","routeTicketId","lookingForTicket","shopId","shop","id","missionId","payment","amount","paymentId","paymentType","receiptId","receiptPhotoUrl","receiptUrl","data","onPayAmount","Amount","onRulesPress","rules","terms","Rules","isVisible","shared","invited","showModalVisible","error","showErrorModalVisible","setState","prevProps","prevState","route","routeState","type","submitRouteTicketError","message","setTimeout","submitRouteTicketResult","ids","routeTicketState","routeTickets","forEach","routeTicket","routeIds","toolTipVisible","settingInfo","fbPost","share","openURL","console","log","title","shareOptions","url","subject","Share","then","action","activityType","dismissedAction","catch","result","RouteRanking","missionState","modalActive","rewards","rewardState","submitRouteTicketLoading","readLoadingRouteTicket","readLoadingRoute","readLoadingMission","readLoadingReward","missions","banner","images","require","map","station","uncompleteMissions","completedMissions","processedMissions","sort","a","b","minSpend","completedMission","filter","length","completed","push","onUnlockPress","bind","onShare","onInvite","onRankingPress","mapStateToProps","RouteTicket","submitLoading","submitResult","submitError","Route","Mission","Reward","Settings","info","readLoading"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { Share } from \"react-native\";\r\nimport { connect } from \"react-redux\";\r\nimport { Actions } from \"react-native-router-flux\";\r\n\r\nimport { SingleRoutes } from \"../../../../components/templates\";\r\n\r\nimport {\r\n  listenToRecord as listenToRoute,\r\n  removeListenerToRecord as removeListenerFromRoute,\r\n} from \"../../../../redux/route/action\";\r\n\r\nimport {\r\n  listenToRecord as listenToRouteTicket,\r\n  removeListenerToRecord as removeListenerFromRouteTicket,\r\n  submitToBackend as submitRouteTicket,\r\n} from \"../../../../redux/routeTicket/action\";\r\n\r\nimport {\r\n  readFromDatabase as readMissions,\r\n  modalControl as missionModalControl,\r\n} from \"../../../../redux/mission/action\";\r\n\r\nimport { readFromDatabase as readRewards } from \"../../../../redux/reward/action\";\r\n\r\nimport { submitToBackend as submitTransaction } from \"../../../../redux/transaction/action\";\r\n\r\nimport styles from \"./styles\";\r\n\r\nimport { Linking } from \"expo\";\r\nimport clone from \"clone\"\r\n\r\nclass index extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      isVisible: false,\r\n      shared: false,\r\n      invited: false,\r\n      showModalVisible: true,\r\n      routeTicketId: null,\r\n      error: null,\r\n      showErrorModalVisible: false,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { routeId } = this.props.navigation.state.params;\r\n    const routeTicketId = this.lookingForTicket({ routeId });\r\n\r\n    this.props.listenToRoute({ routeId });\r\n    this.props.readMissions({ routeId });\r\n    this.props.readRewards({ routeId });\r\n\r\n    if (routeTicketId) {\r\n      this.props.listenToRouteTicket({ routeTicketId });\r\n      this.setState({ routeTicketId: routeTicketId });\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.props.removeListenerFromRoute();\r\n    this.props.removeListenerFromRouteTicket();\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    const { routeId } = this.props.navigation.state.params;\r\n    // Typical usage (don't forget to compare props):\r\n    const { route } = this.props.routeState;\r\n\r\n    if (\r\n      (this.state.shared !== prevState.shared ||\r\n        this.state.invited !== prevState.invited) &&\r\n      route.type === \"Luxury\" &&\r\n      this.state.invited &&\r\n      this.state.shared &&\r\n      !this.state.routeTicketId\r\n    ) {\r\n      this.props.submitRouteTicket({ routeId }, \"create\");\r\n    }\r\n\r\n    if (\r\n      this.state.shared !== prevState.shared &&\r\n      route.type === \"Casual\" &&\r\n      this.state.shared &&\r\n      !this.state.routeTicketId\r\n    ) {\r\n      this.props.submitRouteTicket({ routeId }, \"create\");\r\n    }\r\n\r\n    if (\r\n      this.props.submitRouteTicketError.message !==\r\n        prevProps.submitRouteTicketError.message &&\r\n      this.props.submitRouteTicketError.message\r\n    ) {\r\n      this.setState({\r\n        error: this.props.submitRouteTicketError.message,\r\n        showErrorModalVisible: true,\r\n      });\r\n      setTimeout(() => {\r\n        this.setState({ showErrorModalVisible: false });\r\n      }, 3000);\r\n    }\r\n\r\n    if (\r\n      this.props.submitRouteTicketResult.message !==\r\n        prevProps.submitRouteTicketResult.message &&\r\n      this.props.submitRouteTicketResult.message\r\n    ) {\r\n      this.props.listenToRouteTicket({\r\n        routeTicketId: this.props.submitRouteTicketResult.ids[0],\r\n      });\r\n      this.setState({\r\n        routeTicketId: this.props.submitRouteTicketResult.ids[0],\r\n      });\r\n    }\r\n  }\r\n\r\n  lookingForTicket({ routeId = null }) {\r\n    const { routeTickets = [] } = this.props.routeTicketState;\r\n    let routeTicketId = null;\r\n    routeTickets.forEach((routeTicket) => {\r\n      if (routeTicket.routeIds[0] === routeId) {\r\n        routeTicketId = routeTicket.id;\r\n      }\r\n    });\r\n    return routeTicketId;\r\n  }\r\n\r\n  toolTipPress() {\r\n    this.setState((state) => ({\r\n      toolTipVisible: !state.toolTipVisible,\r\n    }));\r\n  }\r\n\r\n  onUnlockPress() {\r\n    this.setState((state) => ({\r\n      isVisible: !state.isVisible,\r\n    }));\r\n  }\r\n\r\n  onShare() {\r\n    const { settingInfo } = this.props;\r\n    const { fbPost } = settingInfo.share;\r\n    Linking.openURL(`https://www.facebook.com/sharer/sharer.php?u=${fbPost}`);\r\n\r\n    setTimeout(() => {\r\n      this.setState({ shared: true });\r\n      console.log(\"Share successful\");\r\n    }, 3000);\r\n  }\r\n\r\n  onInvite() {\r\n    const { settingInfo } = this.props;\r\n    const { fbPost, title, message } = settingInfo.share;\r\n\r\n    const shareOptions = {\r\n      title,\r\n      message: `${message} ${fbPost}`,\r\n      url: fbPost,\r\n      subject: title,\r\n    };\r\n\r\n    Share.share(shareOptions)\r\n      .then(({ action, activityType }) => {\r\n        if (action === Share.dismissedAction) {\r\n          console.log(\"Share dismissed\");\r\n        } else {\r\n          setTimeout(() => {\r\n            this.setState({ invited: true });\r\n            console.log(\"Share successfuld\");\r\n          }, 3000);\r\n        }\r\n      })\r\n      .catch((error) => this.setState({ result: \"error: \" + error.message }));\r\n  }\r\n\r\n  handleModal = (mission) => {\r\n    this.props.missionModalControl(mission);\r\n  };\r\n\r\n  onPay = (mission) => {\r\n    const { routeId } = this.props.navigation.state.params;\r\n    const routeTicketId = this.lookingForTicket({ routeId });\r\n    const shopId = mission.shop.id;\r\n    const missionId = mission.id;\r\n    const payment = {\r\n      amount: 50,\r\n      paymentId: null,\r\n      paymentType: \"cash\",\r\n      receiptId: null,\r\n      receiptPhotoUrl:\r\n        \"https://image.freepik.com/free-vector/realistic-receipt-template_23-2147938550.jpg\",\r\n      receiptUrl: null,\r\n    };\r\n    const data = { routeId, shopId, routeTicketId, missionId, payment };\r\n    this.props.submitTransaction(data, \"create\");\r\n  };\r\n\r\n  onPayAmount = (mission) => {\r\n    this.props.missionModalControl(mission);\r\n    Actions.Amount({\r\n      mission: mission,\r\n      routeId: this.props.navigation.state.params.routeId,\r\n    });\r\n  };\r\n\r\n  mapPress() {\r\n    //console.log(data)\r\n    console.log('I am clicked')\r\n  }\r\n\r\n  onRulesPress = (rules, terms) => {\r\n    Actions.Rules({ rules, terms });\r\n  };\r\n\r\n  onRankingPress() {\r\n    const { routeId } = this.props.navigation.state.params;\r\n    Actions.RouteRanking({ routeId });\r\n  }\r\n\r\n  render() {\r\n    const { routeTicket } = this.props.routeTicketState;\r\n    const { route } = this.props.routeState;\r\n    const { mission, modalActive } = this.props.missionState;\r\n    const { rewards } = this.props.rewardState;\r\n    const {\r\n      submitRouteTicketLoading,\r\n      readLoadingRouteTicket,\r\n      readLoadingRoute,\r\n      readLoadingMission,\r\n      readLoadingReward,\r\n    } = this.props;\r\n\r\n    let { missions } = clone(this.props.missionState)\r\n\r\n    const banner = route.images[0]\r\n      ? route.images[0]\r\n      : require(\"../../../../assets/banner.jpg\");\r\n\r\n    const map = route.station === 9 ? \r\n      require(\"../../../../assets/gogogain/RouteMap_FA.png\") \r\n      : require(\"../../../../assets/gogogain/RouteMap_FA_Blue.png\")\r\n\r\n    const uncompleteMissions = [];\r\n    const completedMissions = [];\r\n    const processedMissions = [];\r\n\r\n    missions.sort((a,b)=>{\r\n      return a.minSpend - b.minSpend\r\n    })\r\n    \r\n    missions.forEach((mission) => {\r\n      const completedMission = routeTicket.completedMissions.filter((completedMission)=>{\r\n        return completedMission.id === mission.id\r\n      })\r\n\r\n      if (completedMission.length > 0) {\r\n        mission = {...mission, completed: true}\r\n        processedMissions.push(mission)\r\n        // completedMissions.push(mission)\r\n      } else {\r\n        mission = {...mission, completed: false}\r\n        processedMissions.push(mission)\r\n        // uncompleteMissions.push(mission);\r\n      }\r\n    });\r\n\r\n    // missions = [...uncompleteMissions, ...completedMissions]\r\n\r\n    return (\r\n      <SingleRoutes\r\n        currency=\"RM\"\r\n        routeData={route}\r\n        isJoined={this.state.routeTicketId ? true : false}\r\n        routeTicketData={routeTicket}\r\n        banner={banner}\r\n        map={map}\r\n        isVisible={this.state.isVisible}\r\n        onUnlockPress={this.onUnlockPress.bind(this)}\r\n        isUnlockLoading={submitRouteTicketLoading}\r\n        facebookButtonTitle=\"Share our Facebook\"\r\n        inviteButtonTitle=\"Invite Friends\"\r\n        facebookSharePress={this.onShare.bind(this)}\r\n        invitePress={this.onInvite.bind(this)}\r\n        missionData={processedMissions}\r\n        mission={mission}\r\n        missionPress={this.handleModal.bind(this)}\r\n        showModal={modalActive}\r\n        descriptionTitle=\"Description\"\r\n        payTitle=\"Pay\"\r\n        onPay={this.onPay}\r\n        onPayAmount={this.onPayAmount}\r\n        onRulesPress={this.onRulesPress.bind(this)}\r\n        onRankingPress={this.onRankingPress.bind(this)}\r\n        readLoadingRouteTicket={readLoadingRouteTicket}\r\n        readLoadingRoute={readLoadingRoute}\r\n        readLoadingMission={readLoadingMission}\r\n        readLoadingReward={readLoadingReward}\r\n        errorSubmit={this.state.error}\r\n        errorModal={this.state.showErrorModalVisible}\r\n        errorHeader=\"Error\"\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n  const routeTicketState = state.RouteTicket;\r\n  const submitRouteTicketLoading = state.RouteTicket.submitLoading;\r\n  const submitRouteTicketResult = state.RouteTicket.submitResult;\r\n  const submitRouteTicketError = state.RouteTicket.submitError;\r\n  const routeState = state.Route;\r\n  const missionState = state.Mission;\r\n  const rewardState = state.Reward;\r\n  const settingInfo = state.Settings.info;\r\n\r\n  const readLoadingRouteTicket = state.RouteTicket.readLoading;\r\n  const readLoadingRoute = state.Route.readLoading;\r\n  const readLoadingMission = state.Mission.readLoading;\r\n  const readLoadingReward = state.Reward.readLoading;\r\n\r\n  return {\r\n    routeState,\r\n    routeTicketState,\r\n    missionState,\r\n    rewardState,\r\n    settingInfo,\r\n    submitRouteTicketLoading,\r\n    submitRouteTicketResult,\r\n    submitRouteTicketError,\r\n    readLoadingRouteTicket,\r\n    readLoadingRoute,\r\n    readLoadingMission,\r\n    readLoadingReward,\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps, {\r\n  submitRouteTicket,\r\n  listenToRoute,\r\n  removeListenerFromRoute,\r\n  listenToRouteTicket,\r\n  removeListenerFromRouteTicket,\r\n  readMissions,\r\n  missionModalControl,\r\n  readRewards,\r\n  submitTransaction,\r\n})(index);\r\n"]},"metadata":{},"sourceType":"module"}