{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport firebase from \"firebase\";\nimport { GeoCollectionReference, GeoFirestore, GeoQuery, GeoQuerySnapshot, encodeGeohash } from \"geofirestore\";\nimport { permissionsRegistration, LOCATION } from \"../../marslab-library-react-native/utils/system\";\nimport { shopDataServices as objectDataServices } from \"../../services/database\";\nvar type = \"shop\";\nvar actions = {\n  PERMISSION_VERIFICATION: type + \"PERMISSION_VERIFICATION\",\n  PERMISSION_VERIFICATION_SUCCESS: type + \"PERMISSION_VERIFICATIONSUCCESS\",\n  PERMISSION_VERIFICATION_ERROR: type + \"PERMISSION_VERIFICATION_ERROR\",\n  READ_FROM_DATABASE: type + \"READ_FROM_DATABASE\",\n  READ_FROM_DATABASE_SUCCESS: type + \"READ_FROM_DATABASE_SUCCESS\",\n  READ_FROM_DATABASE_ERROR: type + \"READ_FROM_DATABASE_ERROR\",\n  READ_RECORD: type + \"READ_RECORD\",\n  READ_RECORD_SUCCESS: type + \"READ_RECORD_SUCCESS\",\n  READ_RECORD_ERROR: type + \"READ_RECORD_ERROR\"\n};\nvar firestore = firebase.firestore;\nexport var COLLECTION = \"shopPackaging0\";\nvar geoFirestore = new GeoFirestore(firestore());\nvar geoCollectionReference = geoFirestore.collection(COLLECTION);\nexport function verifyPermission() {\n  return function (dispatch) {\n    dispatch({\n      type: actions.PERMISSION_VERIFICATION\n    });\n    return new Promise(function _callee(resolve, reject) {\n      var _await$permissionsReg, _await$permissionsReg2, locationPermission, permissions;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(permissionsRegistration([LOCATION]));\n\n            case 3:\n              _await$permissionsReg = _context.sent;\n              _await$permissionsReg2 = _slicedToArray(_await$permissionsReg, 1);\n              locationPermission = _await$permissionsReg2[0];\n              permissions = {\n                location: locationPermission\n              };\n              resolve(permissions);\n              dispatch({\n                type: actions.PERMISSION_VERIFICATION,\n                payload: {\n                  data: {\n                    permissions: permissions\n                  }\n                }\n              });\n              _context.next = 16;\n              break;\n\n            case 11:\n              _context.prev = 11;\n              _context.t0 = _context[\"catch\"](0);\n              reject(_context.t0);\n              console.log(_context.t0);\n              dispatch({\n                type: actions.PERMISSION_VERIFICATION_ERROR,\n                payload: {\n                  error: _context.t0\n                }\n              });\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[0, 11]], Promise);\n    });\n  };\n}\nexport function loadShops(_ref) {\n  var radius = _ref.radius,\n      latitude = _ref.latitude,\n      longtitude = _ref.longtitude,\n      selectedCategory = _ref.selectedCategory;\n  var limit = 0;\n  return function (dispatch) {\n    dispatch({\n      type: actions.READ_FROM_DATABASE\n    });\n    return new Promise(function (resolve, reject) {\n      radius < 15 ? limit = 0 : limit = 100;\n      selectedCategory !== null && geoCollectionReference.where(\"categories\", \"array-contains-any\", [selectedCategory]).where(\"deleted.at\", \"==\", null).limit(limit).near({\n        center: new firebase.firestore.GeoPoint(latitude, longtitude),\n        radius: radius\n      }).get().then(function (snapshot) {\n        var Data = [];\n        snapshot.forEach(function (doc) {\n          if (doc.data().deleted.at === null) {\n            Data.push(_objectSpread(_objectSpread({}, doc), {}, {\n              id: doc.id\n            }));\n          }\n        });\n        Data.sort(function (a, b) {\n          return a.distance - b.distance;\n        });\n        Data = Data.map(function (item) {\n          return _objectSpread(_objectSpread({}, item.data()), {}, {\n            distance: item.distance,\n            id: item.id\n          });\n        });\n        dispatch({\n          type: actions.READ_FROM_DATABASE_SUCCESS\n        });\n        resolve(Data);\n      }).catch(function (error) {\n        console.log(error);\n        dispatch({\n          type: actions.READ_FROM_DATABASE_ERROR\n        });\n        reject(error);\n      });\n      selectedCategory === null && geoCollectionReference.limit(limit).where(\"deleted.at\", \"==\", null).near({\n        center: new firebase.firestore.GeoPoint(latitude, longtitude),\n        radius: radius\n      }).get().then(function (snapshot) {\n        var Data = [];\n        snapshot.forEach(function (doc) {\n          Data.push(_objectSpread(_objectSpread({}, doc), {}, {\n            id: doc.id\n          }));\n        });\n        Data.sort(function (a, b) {\n          return a.distance - b.distance;\n        });\n        Data = Data.map(function (item) {\n          return _objectSpread(_objectSpread({}, item.data()), {}, {\n            distance: item.distance,\n            id: item.id\n          });\n        });\n        dispatch({\n          type: actions.READ_FROM_DATABASE_SUCCESS\n        });\n        resolve(Data);\n      }).catch(function (error) {\n        console.log(error);\n        dispatch({\n          type: actions.READ_FROM_DATABASE_ERROR\n        });\n        reject(error);\n      });\n    });\n  };\n}\nexport function listenToRecord(_ref2) {\n  var _ref2$shopId = _ref2.shopId,\n      shopId = _ref2$shopId === void 0 ? null : _ref2$shopId;\n  return function (dispatch) {\n    dispatch({\n      type: actions.READ_RECORD\n    });\n    console.log(\"Start listen to shop : \" + shopId + \" \");\n\n    try {\n      objectDataServices.listenObject({\n        objectId: shopId,\n        updateListener: function updateListener(data) {\n          dispatch({\n            type: actions.READ_RECORD_SUCCESS,\n            payload: {\n              data: data\n            }\n          });\n        }\n      });\n    } catch (error) {\n      console.log(error);\n      dispatch({\n        type: actions.READ_RECORD_ERROR,\n        payload: {\n          error: error\n        }\n      });\n    }\n  };\n}\nexport function removeListenerToRecord() {\n  return function (dispatch) {\n    console.log(\"Removed shop listener\");\n    objectDataServices.removeListenerToRecord();\n  };\n}\nexport default actions;","map":{"version":3,"sources":["C:/Gogogain/Gogogain - User/src/redux/shops/action.js"],"names":["firebase","GeoCollectionReference","GeoFirestore","GeoQuery","GeoQuerySnapshot","encodeGeohash","permissionsRegistration","LOCATION","shopDataServices","objectDataServices","type","actions","PERMISSION_VERIFICATION","PERMISSION_VERIFICATION_SUCCESS","PERMISSION_VERIFICATION_ERROR","READ_FROM_DATABASE","READ_FROM_DATABASE_SUCCESS","READ_FROM_DATABASE_ERROR","READ_RECORD","READ_RECORD_SUCCESS","READ_RECORD_ERROR","firestore","COLLECTION","geoFirestore","geoCollectionReference","collection","verifyPermission","dispatch","Promise","resolve","reject","locationPermission","permissions","location","payload","data","console","log","error","loadShops","radius","latitude","longtitude","selectedCategory","limit","where","near","center","GeoPoint","get","then","snapshot","Data","forEach","doc","deleted","at","push","id","sort","a","b","distance","map","item","catch","listenToRecord","shopId","listenObject","objectId","updateListener","removeListenerToRecord"],"mappings":"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","sourcesContent":["import firebase from \"firebase\";\r\nimport {\r\n  GeoCollectionReference,\r\n  GeoFirestore,\r\n  GeoQuery,\r\n  GeoQuerySnapshot,\r\n  encodeGeohash,\r\n} from \"geofirestore\";\r\n\r\nimport {\r\n  permissionsRegistration,\r\n  LOCATION,\r\n} from \"../../marslab-library-react-native/utils/system\";\r\nimport { shopDataServices as objectDataServices } from \"../../services/database\";\r\n\r\nconst type = \"shop\";\r\n\r\nconst actions = {\r\n  PERMISSION_VERIFICATION: type + \"PERMISSION_VERIFICATION\",\r\n  PERMISSION_VERIFICATION_SUCCESS: type + \"PERMISSION_VERIFICATIONSUCCESS\",\r\n  PERMISSION_VERIFICATION_ERROR: type + \"PERMISSION_VERIFICATION_ERROR\",\r\n\r\n  READ_FROM_DATABASE: type + \"READ_FROM_DATABASE\",\r\n  READ_FROM_DATABASE_SUCCESS: type + \"READ_FROM_DATABASE_SUCCESS\",\r\n  READ_FROM_DATABASE_ERROR: type + \"READ_FROM_DATABASE_ERROR\",\r\n\r\n  READ_RECORD: type + \"READ_RECORD\",\r\n  READ_RECORD_SUCCESS: type + \"READ_RECORD_SUCCESS\",\r\n  READ_RECORD_ERROR: type + \"READ_RECORD_ERROR\",\r\n};\r\n\r\nconst { firestore } = firebase;\r\n\r\nexport const COLLECTION = \"shopPackaging0\";\r\n// Create a GeoFirestore reference\r\nconst geoFirestore = new GeoFirestore(firestore());\r\n\r\n// Create a GeoCollection reference\r\nconst geoCollectionReference = geoFirestore.collection(COLLECTION);\r\n\r\nexport function verifyPermission() {\r\n  return (dispatch) => {\r\n    dispatch({ type: actions.PERMISSION_VERIFICATION });\r\n    return new Promise(async (resolve, reject) => {\r\n      try {\r\n        const [locationPermission] = await permissionsRegistration([LOCATION]);\r\n        const permissions = { location: locationPermission };\r\n        resolve(permissions);\r\n        dispatch({\r\n          type: actions.PERMISSION_VERIFICATION,\r\n          payload: { data: { permissions } },\r\n        });\r\n      } catch (error) {\r\n        reject(error);\r\n        console.log(error);\r\n        dispatch({\r\n          type: actions.PERMISSION_VERIFICATION_ERROR,\r\n          payload: { error },\r\n        });\r\n      }\r\n    });\r\n  };\r\n}\r\n\r\nexport function loadShops({ radius, latitude, longtitude, selectedCategory }) {\r\n  let limit = 0;\r\n  return (dispatch) => {\r\n    dispatch({ type: actions.READ_FROM_DATABASE });\r\n    return new Promise((resolve, reject) => {\r\n      radius < 15 ? (limit = 0) : (limit = 100);\r\n      selectedCategory !== null &&\r\n        geoCollectionReference\r\n          .where(\"categories\", \"array-contains-any\", [selectedCategory])\r\n          .where(\"deleted.at\", \"==\", null)\r\n          .limit(limit)\r\n          .near({\r\n            center: new firebase.firestore.GeoPoint(latitude, longtitude),\r\n            radius: radius,\r\n          })\r\n          .get()\r\n          .then((snapshot) => {\r\n            let Data = [];\r\n\r\n            snapshot.forEach(function (doc) {\r\n              \r\n              if(doc.data().deleted.at === null)\r\n              {\r\n                Data.push({ ...doc, id: doc.id });\r\n              }\r\n            });\r\n\r\n            Data.sort((a, b) => a.distance - b.distance);\r\n\r\n            Data = Data.map((item) => {\r\n              return { ...item.data(), distance: item.distance, id: item.id };\r\n            });\r\n            dispatch({ type: actions.READ_FROM_DATABASE_SUCCESS });\r\n            resolve(Data);\r\n          })\r\n          .catch((error) => {\r\n            console.log(error);\r\n            dispatch({ type: actions.READ_FROM_DATABASE_ERROR });\r\n\r\n            reject(error);\r\n          });\r\n\r\n      selectedCategory === null &&\r\n        geoCollectionReference\r\n          .limit(limit)\r\n          .where(\"deleted.at\", \"==\", null)\r\n          .near({\r\n            center: new firebase.firestore.GeoPoint(latitude, longtitude),\r\n            radius: radius,\r\n          })\r\n          .get()\r\n          .then((snapshot) => {\r\n            var Data = [];\r\n\r\n            snapshot.forEach(function (doc) {\r\n              //console.log(doc.data().displayName, doc.data().deleted_at)\r\n            //   if (doc.data().deleted.at === null) {\r\n                Data.push({ ...doc, id: doc.id });\r\n            //   }\r\n            });\r\n\r\n            Data.sort((a, b) => a.distance - b.distance);\r\n\r\n            Data = Data.map((item) => {\r\n              return { ...item.data(), distance: item.distance, id: item.id };\r\n            });\r\n            dispatch({ type: actions.READ_FROM_DATABASE_SUCCESS });\r\n            resolve(Data);\r\n          })\r\n          .catch((error) => {\r\n            console.log(error);\r\n            dispatch({ type: actions.READ_FROM_DATABASE_ERROR });\r\n\r\n            reject(error);\r\n          });\r\n    });\r\n  };\r\n}\r\n\r\nexport function listenToRecord({ shopId = null }) {\r\n  return (dispatch) => {\r\n    dispatch({ type: actions.READ_RECORD });\r\n    console.log(`Start listen to shop : ${shopId} `)\r\n    try {\r\n      objectDataServices.listenObject({\r\n        objectId: shopId,\r\n        updateListener: (data) => {\r\n          dispatch({\r\n            type: actions.READ_RECORD_SUCCESS,\r\n            payload: { data },\r\n          });\r\n        },\r\n      });\r\n    } catch (error) {\r\n      console.log(error);\r\n      dispatch({\r\n        type: actions.READ_RECORD_ERROR,\r\n        payload: { error },\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\nexport function removeListenerToRecord() {\r\n  return (dispatch) => {\r\n    console.log(\"Removed shop listener\")\r\n    objectDataServices.removeListenerToRecord();\r\n  }\r\n}\r\n\r\nexport default actions;\r\n"]},"metadata":{},"sourceType":"module"}