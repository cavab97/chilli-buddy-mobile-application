{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"C:\\\\Gogogain\\\\Gogogain - User\\\\src\\\\screens\\\\main\\\\Shops\\\\index.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { Actions } from \"react-native-router-flux\";\nimport * as Location from \"expo-location\";\nimport { verifyPermission, loadShops } from \"@redux/shops/action\";\nimport styles from \"./styles\";\nimport { FlatList, Image, ModalSelector, Text, TouchableOpacity, View } from \"@components/atoms\";\nimport { Card, CardSection } from \"@components/molecules\";\nimport MaterialCommunityIcons from \"@expo/vector-icons/MaterialCommunityIcons\";\nimport Icon from \"@expo/vector-icons/FontAwesome\";\nvar ITEMS_PER_PAGE = 10;\n\nfunction Item(_ref) {\n  var name = _ref.name,\n      shopID = _ref.shopID,\n      logo = _ref.logo,\n      _ref$picture = _ref.picture,\n      picture = _ref$picture === void 0 ? [] : _ref$picture,\n      address = _ref.address,\n      subscribers = _ref.subscribers,\n      distance = _ref.distance,\n      endDate = _ref.endDate,\n      index = _ref.index,\n      onPress = _ref.onPress,\n      onSubscribePress = _ref.onSubscribePress,\n      subscribed = _ref.subscribed;\n  var image = styles.image,\n      title = styles.title,\n      detail = styles.detail,\n      subscribe = styles.subscribe,\n      profile = styles.profile;\n  var cover = \"\";\n  if (picture.length === 0) cover = require(\"../../../../assets/404NotFound800x533.jpg\");else cover = {\n    uri: picture[0]\n  };\n  var icon = \"\";\n  if (logo.length === 0) icon = require(\"../../../../assets/logo.png\");else icon = {\n    uri: logo[0]\n  };\n  return React.createElement(TouchableOpacity, {\n    onPress: onPress,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 5\n    }\n  }, React.createElement(Card, {\n    style: {\n      width: \"98%\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 7\n    }\n  }, React.createElement(CardSection, {\n    style: {\n      borderBottomWidth: 0\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 9\n    }\n  }, React.createElement(Image, {\n    style: image,\n    resizeMode: \"cover\",\n    source: cover,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 11\n    }\n  })), React.createElement(CardSection, {\n    style: {\n      paddingHorizontal: 15,\n      borderBottomWidth: 0\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 9\n    }\n  }, React.createElement(Text, {\n    style: title,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 11\n    }\n  }, name)), React.createElement(CardSection, {\n    style: {\n      paddingHorizontal: 15,\n      borderBottomWidth: 0\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 9\n    }\n  }, React.createElement(MaterialCommunityIcons, {\n    name: \"map-marker-distance\",\n    size: 16,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 11\n    }\n  }), React.createElement(Text, {\n    style: detail,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 11\n    }\n  }, \"Just \", +(Math.round(distance + \"e+2\") + \"e-2\"), \" Km away\")), React.createElement(CardSection, {\n    style: {\n      paddingHorizontal: 15,\n      borderBottomWidth: 0,\n      marginBottom: 10\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 9\n    }\n  }, React.createElement(Icon, {\n    name: \"location-arrow\",\n    size: 16,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 11\n    }\n  }), React.createElement(Text, {\n    style: detail,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 11\n    }\n  }, address.line1, \" \", address.line2)), React.createElement(TouchableOpacity, {\n    style: profile,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 9\n    }\n  }, React.createElement(Image, {\n    style: {\n      width: 50,\n      height: 50,\n      borderRadius: 50\n    },\n    source: icon,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 11\n    }\n  }))));\n}\n\nvar index = function (_Component) {\n  _inherits(index, _Component);\n\n  var _super = _createSuper(index);\n\n  function index(props) {\n    var _this;\n\n    _classCallCheck(this, index);\n\n    _this = _super.call(this, props);\n\n    _this.componentDidMount = function _callee() {\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.props.verifyPermission().then(function (permissions) {\n                if (permissions.location !== \"granted\") {\n                  alert(\"Permission to access location is necessary\");\n                } else _this.handleRefresh();\n              });\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.handleRefresh = function _callee2() {\n      var radius, i, location;\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              radius = 50;\n              i = 1;\n\n              _this.setState({\n                isRefreshing: true\n              });\n\n              _context2.next = 5;\n              return _regeneratorRuntime.awrap(Location.getCurrentPositionAsync({}));\n\n            case 5:\n              location = _context2.sent;\n\n            case 6:\n              _context2.next = 8;\n              return _regeneratorRuntime.awrap(_this.props.loadShops({\n                radius: radius * i,\n                latitude: location.coords.latitude,\n                longtitude: location.coords.longitude,\n                selectedCategory: _this.state.selectedCategory.id ? _this.state.selectedCategory.id : null\n              }).then(function (Data) {\n                _this.setState({\n                  dataSource: Data,\n                  page: 0,\n                  data: []\n                });\n\n                Data.length !== 0 && _this.filterData();\n              }).catch(function (error) {\n                alert(error);\n              }));\n\n            case 8:\n              i = i * 3;\n\n            case 9:\n              if (_this.state.dataSource.length === 0 && radius * i < 1000) {\n                _context2.next = 6;\n                break;\n              }\n\n            case 10:\n              _this.setState({\n                isRefreshing: false\n              });\n\n              i = 1;\n\n            case 12:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.onSubscribePressed = function _callee5(status, shopID, index) {\n      var data, subscribedList;\n      return _regeneratorRuntime.async(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              data = _this.state.data;\n              subscribedList = _this.props.subscribedList;\n\n              if (!status) {\n                subscribedList.push(shopID);\n\n                _this.props.updateSubscribeList({\n                  subscribedList: subscribedList\n                });\n\n                data[index].subscribed = true;\n\n                _this.setState({\n                  data: data\n                });\n\n                fetch(FIREBASE_CLOUD_FUNCTION + \"/subscribes/subscribe\", {\n                  method: \"POST\",\n                  headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"Access-Control-Allow-Origin\": \"*\",\n                    Accept: \"application/json\",\n                    Authorization: \"Bearer\" + _this.props.idToken\n                  },\n                  body: JSON.stringify({\n                    shopID: shopID\n                  })\n                }).then(function _callee3(response) {\n                  var responseJson;\n                  return _regeneratorRuntime.async(function _callee3$(_context3) {\n                    while (1) {\n                      switch (_context3.prev = _context3.next) {\n                        case 0:\n                          _context3.next = 2;\n                          return _regeneratorRuntime.awrap(response.json());\n\n                        case 2:\n                          responseJson = _context3.sent;\n\n                          if (response.status === 200) {} else {\n                            console.log(\"Subscribe error :\" + JSON.stringify(responseJson));\n                          }\n\n                        case 4:\n                        case \"end\":\n                          return _context3.stop();\n                      }\n                    }\n                  }, null, null, null, Promise);\n                }).catch(function (error) {\n                  console.error(error);\n                });\n              } else {\n                subscribedList = subscribedList.filter(function (item) {\n                  return item !== shopID;\n                });\n\n                _this.props.updateSubscribeList({\n                  subscribedList: subscribedList\n                });\n\n                data[index].subscribed = false;\n\n                _this.setState({\n                  data: data\n                });\n\n                fetch(FIREBASE_CLOUD_FUNCTION + \"/subscribes/unsubscribe\", {\n                  method: \"POST\",\n                  headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"Access-Control-Allow-Origin\": \"*\",\n                    Accept: \"application/json\",\n                    Authorization: \"Bearer\" + _this.props.idToken\n                  },\n                  body: JSON.stringify({\n                    shopID: shopID\n                  })\n                }).then(function _callee4(response) {\n                  var responseJson;\n                  return _regeneratorRuntime.async(function _callee4$(_context4) {\n                    while (1) {\n                      switch (_context4.prev = _context4.next) {\n                        case 0:\n                          _context4.next = 2;\n                          return _regeneratorRuntime.awrap(response.json());\n\n                        case 2:\n                          responseJson = _context4.sent;\n\n                          if (response.status === 200) {} else {\n                            console.log(\"unSubscribe error :\" + JSON.stringify(responseJson));\n                          }\n\n                        case 4:\n                        case \"end\":\n                          return _context4.stop();\n                      }\n                    }\n                  }, null, null, null, Promise);\n                }).catch(function (error) {\n                  console.error(error);\n                });\n              }\n\n            case 3:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.state = {\n      data: [],\n      dataSource: [],\n      filteredData: [],\n      page: 0,\n      isRefreshing: false,\n      tags: props.tags,\n      categories: props.categories,\n      selectedCategory: {},\n      selectedTag: \"All\"\n    };\n    _this.onSubscribePressed = _this.onSubscribePressed.bind(_assertThisInitialized(_this));\n    _this.handleLoadMore = _this.handleLoadMore.bind(_assertThisInitialized(_this));\n    _this.handleRefresh = _this.handleRefresh.bind(_assertThisInitialized(_this));\n    _this.renderFooter = _this.renderFooter.bind(_assertThisInitialized(_this));\n    _this.filterData = _this.filterData.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(index, [{\n    key: \"handleLoadMore\",\n    value: function handleLoadMore() {\n      var _this$state = this.state,\n          page = _this$state.page,\n          data = _this$state.data;\n      var start = page * ITEMS_PER_PAGE;\n      var end = (page + 1) * ITEMS_PER_PAGE;\n      var newData = this.state.filteredData.slice(start, end);\n      this.setState({\n        data: [].concat(_toConsumableArray(data), _toConsumableArray(newData)),\n        page: page + 1\n      });\n    }\n  }, {\n    key: \"filterData\",\n    value: function filterData() {\n      var _this2 = this;\n\n      var filteredData = this.state.selectedTag !== \"All\" ? this.state.dataSource.filter(function (item) {\n        return item.tags.map(function (tag) {\n          return tag;\n        }).includes(_this2.state.selectedTag);\n      }) : this.state.dataSource;\n      var dataDisplay = [];\n      filteredData.map(function (data) {\n        dataDisplay.push(_objectSpread({}, data));\n      });\n      this.setState({\n        filteredData: dataDisplay,\n        page: 0,\n        data: []\n      });\n      this.handleLoadMore();\n    }\n  }, {\n    key: \"renderFooter\",\n    value: function renderFooter(_ref2) {\n      var empty = _ref2.empty;\n\n      if (empty) {\n        return Platform.OS === \"ios\" ? React.createElement(Card, {\n          style: {\n            backgroundColor: \"transparent\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 229,\n            columnNumber: 11\n          }\n        }, React.createElement(CardSection, {\n          style: styles.emptySection,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 230,\n            columnNumber: 13\n          }\n        }, React.createElement(Icon, {\n          name: \"inbox\",\n          size: 64,\n          style: styles.emptyIcon,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 15\n          }\n        }), React.createElement(Text, {\n          style: styles.emptyText,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 232,\n            columnNumber: 15\n          }\n        }, \"NO MERCHANT FOUND\"))) : React.createElement(Card, {\n          style: {\n            backgroundColor: \"transparent\",\n            elevation: 0\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 11\n          }\n        }, React.createElement(CardSection, {\n          style: [styles.emptySection, {\n            elevation: 0\n          }],\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 237,\n            columnNumber: 13\n          }\n        }, React.createElement(Icon, {\n          name: \"inbox\",\n          size: 64,\n          style: styles.emptyIcon,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 15\n          }\n        }), React.createElement(Text, {\n          style: styles.emptyText,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 15\n          }\n        }, \"NO MERCHANT FOUND\")));\n      } else {\n        return React.createElement(View, {\n          style: {\n            marginBottom: 10\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 245,\n            columnNumber: 14\n          }\n        });\n      }\n    }\n  }, {\n    key: \"onMerchantPressed\",\n    value: function onMerchantPressed(item) {\n      Actions.SingleMerchant({\n        shopId: item.id\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return React.createElement(View, {\n        style: {\n          height: \"100%\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 320,\n          columnNumber: 7\n        }\n      }, React.createElement(View, {\n        style: {\n          flexDirection: \"row\",\n          justifyContent: \"flex-end\",\n          marginBottom: 8\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 321,\n          columnNumber: 9\n        }\n      }, React.createElement(ModalSelector, {\n        onChange: function onChange(option) {\n          _this3.setState({\n            selectedCategory: option,\n            selectedTag: \"All\"\n          });\n\n          _this3.handleRefresh();\n        },\n        data: this.state.categories,\n        initValue: \"Select Categories\",\n        style: styles.categoriesButton,\n        selectStyle: styles.categoriesSelect,\n        selectTextStyle: styles.modalSelectTextStyle,\n        optionTextStyle: styles.modalOptionTextStyle,\n        keyExtractor: function keyExtractor(item) {\n          return item.id;\n        },\n        labelExtractor: function labelExtractor(item) {\n          return item.title;\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 11\n        }\n      }), React.createElement(ModalSelector, {\n        data: this.state.selectedCategory.tags,\n        keyExtractor: function keyExtractor(item) {\n          return item;\n        },\n        labelExtractor: function labelExtractor(item) {\n          return _this3.state.tags.filter(function (tag) {\n            return tag.id === item;\n          }).map(function (_ref3) {\n            var title = _ref3.title;\n            return title;\n          })[0];\n        },\n        onChange: function onChange(option) {\n          _this3.setState({\n            selectedTag: option\n          });\n\n          _this3.handleRefresh();\n\n          _this3.filterData();\n        },\n        selectStyle: styles.categoriesSelect,\n        selectTextStyle: styles.modalSelectTextStyle,\n        optionTextStyle: styles.modalOptionTextStyle,\n        style: {\n          justifyContent: \"center\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 343,\n          columnNumber: 11\n        }\n      }, React.createElement(Icon, {\n        name: \"filter\",\n        size: 20,\n        style: styles.tagsButton,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 361,\n          columnNumber: 13\n        }\n      }))), React.createElement(FlatList, {\n        data: this.state.data,\n        renderItem: function renderItem(_ref4) {\n          var item = _ref4.item,\n              index = _ref4.index;\n          return React.createElement(Item, {\n            onPress: function onPress() {\n              return _this3.onMerchantPressed(item);\n            },\n            onSubscribePress: _this3.onSubscribePressed,\n            name: item.displayTitle,\n            logo: item.logo,\n            picture: item.images,\n            address: item.address,\n            subscribers: item.subscribers,\n            subscribed: item.subscribed,\n            distance: item.distance,\n            shopID: item.id,\n            index: index,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 368,\n              columnNumber: 13\n            }\n          });\n        },\n        keyExtractor: function keyExtractor(item) {\n          return item.id;\n        },\n        onRefresh: this.handleRefresh,\n        refreshing: this.state.isRefreshing,\n        onEndReached: this.handleLoadMore,\n        onEndReachedThreshold: 0.5,\n        ListFooterComponent: this.renderFooter({\n          empty: this.state.data.length === 0 ? true : false\n        }),\n        style: styles.flatList,\n        extraData: this.state,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 365,\n          columnNumber: 9\n        }\n      }));\n    }\n  }]);\n\n  return index;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  var _state$Settings = state.Settings,\n      categories = _state$Settings.categories,\n      tags = _state$Settings.tags;\n  var uid = state.Auth.user.uid;\n  var _state$Auth = state.Auth,\n      subscribedList = _state$Auth.subscribedList,\n      idToken = _state$Auth.idToken;\n  return {\n    categories: categories,\n    tags: tags,\n    uid: uid,\n    idToken: idToken,\n    subscribedList: subscribedList\n  };\n};\n\nexport default connect(mapStateToProps, {\n  verifyPermission: verifyPermission,\n  loadShops: loadShops\n})(index);","map":{"version":3,"sources":["C:/Gogogain/Gogogain - User/src/screens/main/Shops/index.js"],"names":["React","Component","connect","Actions","Location","verifyPermission","loadShops","styles","FlatList","Image","ModalSelector","Text","TouchableOpacity","View","Card","CardSection","MaterialCommunityIcons","Icon","ITEMS_PER_PAGE","Item","name","shopID","logo","picture","address","subscribers","distance","endDate","index","onPress","onSubscribePress","subscribed","image","title","detail","subscribe","profile","cover","length","require","uri","icon","width","borderBottomWidth","paddingHorizontal","Math","round","marginBottom","line1","line2","height","borderRadius","props","componentDidMount","then","permissions","location","alert","handleRefresh","radius","i","setState","isRefreshing","getCurrentPositionAsync","latitude","coords","longtitude","longitude","selectedCategory","state","id","Data","dataSource","page","data","filterData","catch","error","onSubscribePressed","status","subscribedList","push","updateSubscribeList","fetch","FIREBASE_CLOUD_FUNCTION","method","headers","Accept","Authorization","idToken","body","JSON","stringify","response","json","responseJson","console","log","filter","item","filteredData","tags","categories","selectedTag","bind","handleLoadMore","renderFooter","start","end","newData","slice","map","tag","includes","dataDisplay","empty","Platform","OS","backgroundColor","emptySection","emptyIcon","emptyText","elevation","SingleMerchant","shopId","flexDirection","justifyContent","option","categoriesButton","categoriesSelect","modalSelectTextStyle","modalOptionTextStyle","tagsButton","onMerchantPressed","displayTitle","images","flatList","mapStateToProps","Settings","uid","Auth","user"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Actions } from \"react-native-router-flux\";\r\nimport * as Location from \"expo-location\";\r\n\r\nimport { verifyPermission, loadShops } from \"@redux/shops/action\";\r\n\r\nimport styles from \"./styles\";\r\n\r\nimport {\r\n  FlatList,\r\n  Image,\r\n  ModalSelector,\r\n  Text,\r\n  TouchableOpacity,\r\n  View,\r\n} from \"@components/atoms\";\r\n\r\nimport {\r\n  Card,\r\n  CardSection\r\n} from \"@components/molecules\";\r\n\r\nimport MaterialCommunityIcons from \"react-native-vector-icons/MaterialCommunityIcons\";\r\nimport Icon from \"react-native-vector-icons/FontAwesome\";\r\n\r\nconst ITEMS_PER_PAGE = 10;\r\n\r\nfunction Item({\r\n  name,\r\n  shopID,\r\n  logo,\r\n  picture=[],\r\n  address,\r\n  subscribers,\r\n  distance,\r\n  endDate,\r\n  index,\r\n  onPress,\r\n  onSubscribePress,\r\n  subscribed\r\n}) {\r\n  const { image, title, detail, subscribe, profile } = styles;\r\n\r\n  let cover = \"\";\r\n  if (picture.length === 0 ) cover = require(\"../../../../assets/404NotFound800x533.jpg\");\r\n  else cover = { uri: picture[0] };\r\n\r\n  let icon = \"\";\r\n  if ( logo.length === 0) icon = require(\"../../../../assets/logo.png\");\r\n  else icon = { uri: logo[0] };\r\n\r\n  return (\r\n    <TouchableOpacity onPress={onPress}>\r\n      <Card style={{ width: \"98%\" }}>\r\n        <CardSection\r\n          style={{\r\n            borderBottomWidth: 0,\r\n          }}\r\n        >\r\n          <Image style={image} resizeMode=\"cover\" source={cover} />\r\n        </CardSection>\r\n        <CardSection \r\n          style={{\r\n            paddingHorizontal: 15,\r\n            borderBottomWidth: 0,\r\n          }}\r\n        >\r\n          <Text style={title}>{name}</Text>\r\n        </CardSection>\r\n        <CardSection\r\n          style={{\r\n            paddingHorizontal: 15,\r\n            borderBottomWidth: 0,\r\n          }}\r\n        >\r\n          <MaterialCommunityIcons name=\"map-marker-distance\" size={16} />\r\n          <Text style={detail}>\r\n            Just {+(Math.round(distance + \"e+2\") + \"e-2\")} Km away\r\n          </Text>\r\n        </CardSection>\r\n\r\n        <CardSection\r\n          style={{\r\n            paddingHorizontal: 15,\r\n            borderBottomWidth: 0,\r\n            marginBottom: 10\r\n          }}\r\n        >\r\n          <Icon name=\"location-arrow\" size={16} />\r\n          <Text style={detail}>\r\n            {address.line1} {address.line2}\r\n          </Text>\r\n        </CardSection>\r\n        {/* <TouchableOpacity\r\n          style={subscribe}\r\n          onPress={() => onSubscribePress(subscribed, shopID, index)}\r\n        >\r\n          <Text\r\n            style={{\r\n              color: \"#fff\",\r\n              fontSize: 16,\r\n              fontWeight: \"bold\"\r\n            }}\r\n          >\r\n            {subscribed ? \"Unsubscribe\" : \"Subscribe\"}\r\n          </Text>\r\n        </TouchableOpacity> */}\r\n        <TouchableOpacity style={profile}>\r\n          <Image\r\n            style={{\r\n              width: 50,\r\n              height: 50,\r\n              borderRadius: 50\r\n            }}\r\n            source={icon}\r\n          />\r\n        </TouchableOpacity>\r\n      </Card>\r\n    </TouchableOpacity>\r\n  );\r\n}\r\n\r\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nclass index extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      data: [],\r\n      dataSource: [],\r\n      filteredData: [],\r\n      page: 0,\r\n      // isLoading:false,\r\n      isRefreshing: false,\r\n      tags: props.tags,\r\n      categories: props.categories,\r\n      selectedCategory: {},\r\n      selectedTag: \"All\" //default all tag selected\r\n    };\r\n    this.onSubscribePressed = this.onSubscribePressed.bind(this);\r\n    this.handleLoadMore = this.handleLoadMore.bind(this);\r\n    this.handleRefresh = this.handleRefresh.bind(this);\r\n    this.renderFooter = this.renderFooter.bind(this);\r\n    this.filterData = this.filterData.bind(this);\r\n  }\r\n\r\n  // old ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n  componentDidMount = async () => {\r\n    this.props.verifyPermission().then(permissions => {\r\n      if (permissions.location !== \"granted\") {\r\n        alert(\"Permission to access location is necessary\");\r\n      } else this.handleRefresh();\r\n    });\r\n  };\r\n\r\n  handleRefresh = async () => {\r\n    const radius = 50;\r\n    let i = 1;\r\n\r\n    this.setState({ isRefreshing: true });\r\n    let location = await Location.getCurrentPositionAsync({});\r\n    do {\r\n      await this.props\r\n        .loadShops({\r\n          radius: radius * i,\r\n          latitude: location.coords.latitude,\r\n          longtitude: location.coords.longitude,\r\n          selectedCategory: this.state.selectedCategory.id\r\n            ? this.state.selectedCategory.id\r\n            : null\r\n        })\r\n        .then(Data => {\r\n          this.setState({ dataSource: Data, page: 0, data: [] });\r\n          Data.length !== 0 && this.filterData();\r\n        })\r\n        .catch(error => {\r\n          alert(error);\r\n        });\r\n      i = i * 3;\r\n    } while (this.state.dataSource.length === 0 && radius * i < 1000);\r\n    this.setState({\r\n      isRefreshing: false\r\n      //isLoading:false\r\n    });\r\n    i = 1;\r\n    //console.log(this.state.dataSource.length)\r\n  };\r\n\r\n  handleLoadMore() {\r\n    //this.setState({isLoading:true})\r\n    const { page, data } = this.state;\r\n    const start = page * ITEMS_PER_PAGE;\r\n    const end = (page + 1) * ITEMS_PER_PAGE;\r\n\r\n    const newData = this.state.filteredData.slice(start, end); // here, we will receive next batch of the items\r\n    this.setState({ data: [...data, ...newData], page: page + 1 }); // here we are appending new batch to existing batch\r\n  }\r\n\r\n  filterData() {\r\n    const filteredData =\r\n      this.state.selectedTag !== \"All\"\r\n        ? this.state.dataSource.filter(item => {\r\n            return item.tags\r\n              .map(tag => {\r\n                return tag;\r\n              })\r\n              .includes(this.state.selectedTag);\r\n          })\r\n        : this.state.dataSource;\r\n    const dataDisplay = [];\r\n    filteredData.map(data => {\r\n      dataDisplay.push({\r\n        ...data\r\n        //subscribed: this.props.subscribedList.includes(data.id)\r\n      });\r\n    });\r\n    this.setState({ filteredData: dataDisplay, page: 0, data: [] });\r\n    this.handleLoadMore();\r\n  }\r\n\r\n  renderFooter({empty}) {\r\n    if(empty){\r\n      return (\r\n        // this.state.isLoading?\r\n        // <View style={styles.loader}>\r\n        //     <ActivityIndicator size=\"large\"/>\r\n        // </View> :null\r\n        Platform.OS === \"ios\" ? (\r\n          <Card style={{ backgroundColor: \"transparent\" }}>\r\n            <CardSection style={styles.emptySection}>\r\n              <Icon name=\"inbox\" size={64} style={styles.emptyIcon} />\r\n              <Text style={styles.emptyText}>NO MERCHANT FOUND</Text>\r\n            </CardSection>\r\n          </Card>\r\n        ) : (\r\n          <Card style={{ backgroundColor: \"transparent\", elevation: 0 }}>\r\n            <CardSection style={[styles.emptySection, { elevation: 0 }]}>\r\n              <Icon name=\"inbox\" size={64} style={styles.emptyIcon} />\r\n              <Text style={styles.emptyText}>NO MERCHANT FOUND</Text> \r\n            </CardSection>\r\n          </Card>\r\n        )\r\n      );\r\n    }else{\r\n      return <View style={{marginBottom: 10}} />\r\n    }\r\n  }\r\n\r\n  onMerchantPressed(item) {\r\n    Actions.SingleMerchant({ shopId: item.id });\r\n  }\r\n\r\n  onSubscribePressed = async (status, shopID, index) => {\r\n    const data = this.state.data;\r\n    //console.log(this.props.idToken)\r\n    let subscribedList = this.props.subscribedList;\r\n\r\n    if (!status) {\r\n      subscribedList.push(shopID);\r\n      this.props.updateSubscribeList({ subscribedList });\r\n      data[index].subscribed = true;\r\n      this.setState({ data: data });\r\n\r\n      fetch(`${FIREBASE_CLOUD_FUNCTION}/subscribes/subscribe`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Access-Control-Allow-Origin\": \"*\",\r\n          Accept: \"application/json\",\r\n          Authorization: \"Bearer\" + this.props.idToken\r\n        },\r\n        body: JSON.stringify({ shopID })\r\n      })\r\n        .then(async response => {\r\n          const responseJson = await response.json();\r\n\r\n          if (response.status === 200) {\r\n          } else {\r\n            console.log(\"Subscribe error :\" + JSON.stringify(responseJson));\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error(error);\r\n        });\r\n    } else {\r\n      subscribedList = subscribedList.filter(item => item !== shopID);\r\n      this.props.updateSubscribeList({ subscribedList });\r\n      data[index].subscribed = false;\r\n      this.setState({ data: data });\r\n\r\n      fetch(`${FIREBASE_CLOUD_FUNCTION}/subscribes/unsubscribe`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Access-Control-Allow-Origin\": \"*\",\r\n          Accept: \"application/json\",\r\n          Authorization: \"Bearer\" + this.props.idToken\r\n        },\r\n        body: JSON.stringify({ shopID })\r\n      })\r\n        .then(async response => {\r\n          const responseJson = await response.json();\r\n\r\n          if (response.status === 200) {\r\n          } else {\r\n            console.log(\"unSubscribe error :\" + JSON.stringify(responseJson));\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error(error);\r\n        });\r\n    }\r\n  };\r\n\r\n  // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\n  render() {\r\n\r\n    return (\r\n      <View style={{height: \"100%\"}}>\r\n        <View\r\n          style={{\r\n            flexDirection: \"row\",\r\n            justifyContent: \"flex-end\",\r\n            marginBottom: 8\r\n          }}\r\n        >\r\n          <ModalSelector\r\n            onChange={option => {\r\n              this.setState({ selectedCategory: option, selectedTag: \"All\" });\r\n              this.handleRefresh();\r\n            }}\r\n            data={this.state.categories}\r\n            initValue=\"Select Categories\"\r\n            style={styles.categoriesButton}\r\n            selectStyle={styles.categoriesSelect}\r\n            selectTextStyle={styles.modalSelectTextStyle}\r\n            optionTextStyle={styles.modalOptionTextStyle}\r\n            keyExtractor={item => item.id}\r\n            labelExtractor={item => item.title}\r\n          />\r\n\r\n          <ModalSelector\r\n            data={this.state.selectedCategory.tags}\r\n            keyExtractor={item => item}\r\n            labelExtractor={item =>\r\n              this.state.tags\r\n                .filter(tag => tag.id === item)\r\n                .map(({ title }) => title)[0]\r\n            }\r\n            onChange={option => {\r\n              this.setState({ selectedTag: option });\r\n              this.handleRefresh();\r\n              this.filterData();\r\n            }}\r\n            selectStyle={styles.categoriesSelect}\r\n            selectTextStyle={styles.modalSelectTextStyle}\r\n            optionTextStyle={styles.modalOptionTextStyle}\r\n            style={{ justifyContent: \"center\" }}\r\n          >\r\n            <Icon name=\"filter\" size={20} style={styles.tagsButton} />\r\n          </ModalSelector>\r\n        </View>\r\n\r\n        <FlatList\r\n          data={this.state.data}\r\n          renderItem={({ item, index }) => (\r\n            <Item\r\n              onPress={() => this.onMerchantPressed(item)}\r\n              onSubscribePress={this.onSubscribePressed}\r\n              name={item.displayTitle}\r\n              logo={item.logo}\r\n              picture={item.images}\r\n              address={item.address}\r\n              subscribers={item.subscribers}\r\n              subscribed={item.subscribed}\r\n              distance={item.distance}\r\n              shopID={item.id}\r\n              index={index}\r\n            />\r\n          )}\r\n          keyExtractor={item => item.id}\r\n          onRefresh={this.handleRefresh}\r\n          refreshing={this.state.isRefreshing}\r\n          onEndReached={this.handleLoadMore}\r\n          onEndReachedThreshold={0.5}\r\n          ListFooterComponent={this.renderFooter({empty: (this.state.data.length === 0 ? true : false)})}\r\n          style={styles.flatList}\r\n          extraData={this.state}\r\n        />\r\n      </View>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  const { categories, tags } = state.Settings;\r\n  const { uid } = state.Auth.user;\r\n  const { subscribedList, idToken } = state.Auth;\r\n\r\n  return { categories, tags, uid, idToken, subscribedList };\r\n};\r\n\r\nexport default connect(mapStateToProps, { verifyPermission, loadShops })(index);\r\n"]},"metadata":{},"sourceType":"module"}